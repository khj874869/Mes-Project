server {
  listen 80;
  server_name _;

  # ----- Static: operator / kiosk -----
  location /operator/ {
    alias /usr/share/nginx/html/operator/;
    try_files $uri $uri/ /operator/index.html;
  }

  location /kiosk/ {
    alias /usr/share/nginx/html/kiosk/;
    try_files $uri $uri/ /kiosk/index.html;
  }

  # 루트 접근 시 operator로 보내기(선택)
  location = / {
    return 302 /operator/;
  }

  # ----- API Gateway -----
  # mes-core (8080)
  location /api/core/ {
    proxy_pass http://mes-core:8080/;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_connect_timeout 3s;
    proxy_read_timeout 60s;
  }

  # integration-hub (8083)
  location /api/hub/ {
    proxy_pass http://integration-hub:8083/;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_connect_timeout 3s;
    proxy_read_timeout 60s;
  }

  # ----- Kafka UI (infra compose에 kafka-ui 서비스가 있을 때) -----
  location /kafka-ui/ {
    proxy_pass http://kafka-ui:8080/;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_connect_timeout 3s;
    proxy_read_timeout 60s;
  }

  # (선택) Actuator를 프록시로 열어두면 편함
 location /api/core/ { proxy_pass http://mes-core:8080/; }
 location /api/hub/  { proxy_pass http://integration-hub:8083/; }
}
